<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Simple API using CGI Module - Robotic System Integration Course</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/fontawesome.min.css" rel="stylesheet">
        <link href="../../css/brands.min.css" rel="stylesheet">
        <link href="../../css/solid.min.css" rel="stylesheet">
        <link href="../../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">Robotic System Integration Course</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href="../.." class="nav-link">Home</a>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Ros</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../ros/Introduction%20to%20ROS/" class="dropdown-item">Introduction to ROS</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle active" aria-current="page" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Sys</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../sys1/" class="dropdown-item">What is cloud computing?</a>
</li>
                                    
<li>
    <a href="../sys2/" class="dropdown-item">Setup AWS EC2 instances</a>
</li>
                                    
<li>
    <a href="../sys3/" class="dropdown-item">Back-end and Front-end Development</a>
</li>
                                    
<li>
    <a href="../sys4/" class="dropdown-item">REST API Basics</a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active" aria-current="page">Simple API using CGI Module</a>
</li>
                                    
<li>
    <a href="../sys6/" class="dropdown-item">Debugging REST API with Command Line</a>
</li>
                                    
<li>
    <a href="../sys7/" class="dropdown-item">More on RESTful Communication</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../sys4/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../sys6/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#basics" class="nav-link">Basics</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="1"><a href="#configuring-apache2-for-cgi" class="nav-link">Configuring Apache2 for CGI</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="1"><a href="#creating-your-first-cgi-script" class="nav-link">Creating your first CGI script</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="1"><a href="#simple-restful-api" class="nav-link">Simple RESTful API</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="1"><a href="#optional" class="nav-link">Optional</a>
              <ul class="nav flex-column">
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="basics">Basics</h1>
<p>In computing, Common Gateway Interface (CGI) is an interface specification that enables web servers to execute an external program, typically to process user requests. Such programs are often written in a scripting language and are commonly referred to as CGI scripts, but they may include compiled programs. A typical use case occurs when a web user submits a web form on a web page that uses CGI. The form's data is sent to the web server within an HTTP request with a URL denoting a CGI script. The web server then launches the CGI script in a new computer process, passing the form data to it. The output of the CGI script, usually in the form of HTML, is returned by the script to the Web server, and the server relays it back to the browser as its response to the browser's request.
<a href="https://en.wikipedia.org/wiki/Common_Gateway_Interface">Read more (Wikipedia)</a>.</p>
<h1 id="configuring-apache2-for-cgi">Configuring Apache2 for CGI</h1>
<p>The instructions below are given for ubuntu 22.04 instance. There might be small differences between Linux distributions, particularly with directory names.</p>
<ul>
<li>First, make sure that Apache 2 is installed. In this tutorial, our website is hosted under <code>/var/www/html/</code>. Verify that the server is running in the background: run <code>systemctl status apache2</code>; make sure it shows <code>running</code>. In some Linux distributions, the server name could be <code>httpd</code> instead of <code>apache2</code></li>
<li>Make sure your AWS instance listens to port <code>80</code> (update your inboud security rules)
<img alt="" src="../imgs/sys5-fire.png" /></li>
<li>Create a directory under your root website called <code>cgi</code> </li>
</ul>
<pre><code class="language-bash">sudo mkdir /&lt;root directory&gt;/cgi
</code></pre>
<p>where <code>&lt;root directory&gt;</code> should be replaced by your website root directory. You can find your website root  written somewhere in the apache config under <code>DocumentRoot /var/www/html</code>
* Give the directory 755 permission (read and execute for user and group) using <code>chmod</code> command with root (or sudo). Recall that execute permission for a directory means the ability to access the directory and see files.
*  Open apache configuration with your favorite text editor (gedit, nano, vim,...etc). In Ubuntu, the main config file is <code>/etc/apache2/apache2.conf</code>. (The config is written in XML format, which is self-explanatory to a certain level; you may check the official <a href="https://httpd.apache.org/docs/current/configuring.html">documentation</a> to have more insights)
    *  Once you open the file, you will notice that the config envokes all files under two directories, <code>conf-enabled/</code> and <code>sites-enabled/</code>. Each of those files contains some segments of XML configs. 
    *  You may pick <code>/etc/apache2/sites-available/000-default.conf</code> if it corresponds to your default website. Edit the file and include the configs below</p>
<pre><code>```xml
 &lt;Directory /var/www/html/cgi&gt;
    AllowOverride None
    Options +ExecCGI
    AddHandler cgi-script .cgi .py .sh
    Require all granted
 &lt;/Directory&gt;
```
It basically says that all files that have extensions `.cgi, .py, .sh` under the CGI directory `/var/www/html/cgi/` should be executable.
</code></pre>
<ul>
<li>Enable CGI module in Apache</li>
</ul>
<pre><code class="language-bash">cd /etc/apache2/mods-enabled
sudo ln -s ../mods-available/cgi.load
</code></pre>
<p>where in Ubuntu 22.04  (installed by apt package manager), all modules are listed under <code>/etc/apache2/mods-available/</code>. The second command simply creates a symlink (or shortcut) for <code>cgi.load</code> inside <code>mods-enabled</code> to indicate that CGI module needs to be loaded along with other apache modules 
*  Restart Apache through <a href="https://en.wikipedia.org/wiki/Systemd">Systemd</a>'s utility <code>systemctl restart apache2</code></p>
<h1 id="creating-your-first-cgi-script">Creating your first CGI script</h1>
<ul>
<li>Navigate to your CGI directory</li>
<li>Create a file named <code>test.cgi</code></li>
</ul>
<pre><code class="language-bash">sudo touch test.sh
</code></pre>
<ul>
<li>Change the permission of the file to be executable  </li>
</ul>
<pre><code class="language-bash">sudo chmod +x test.sh
</code></pre>
<ul>
<li>Write a simple bash script that prints some HTML using <code>echo</code> command<p>```bash
  #!/usr/bin/bash</p>
<p>echo -e "Content-type: text/html\n\n"
  echo "<h1>Hello world! this is NSR 4.0</h1>"
  echo "<h2>My name is XXX </h2>"
  <code>``
  where the first line tells the OS which scripting language to use. The last two lines are simple HTML code, and the</code>Content-type`is a part of the http header (notice the two empty lines and option -e for command echo).</p>
</li>
</ul>
<ul>
<li>Go to your browser, and check your cgi script (replace the DNS with your own domain address). The output should be similar to the figure below (not some script source)</li>
</ul>
<p><img alt="" src="../imgs/sys5-hello-world.png" /></p>
<h1 id="simple-restful-api">Simple RESTful API</h1>
<p>The main idea is to learn how to redirect URL addresses to certain files. </p>
<p>We start first with a simple REST API using a module called <code>rewrite</code>. </p>
<ul>
<li>Enable module simply by navigating to <code>mode_enabled directory</code> and creating a sym link.</li>
</ul>
<pre><code class="language-bash">sudo ln -s ../mods-available/rewrite.load
</code></pre>
<ul>
<li>Restart Apache to ensure that the module is loaded</li>
<li>Open apache config file that corresponds to the root site. Locate the <code>&lt;Directory&gt;...&lt;/Directory&gt;</code> directive, which includes the settings. In Ubuntu 22.04 instance, it looks like</li>
</ul>
<p>```xml
 <Directory /var/www/html>
     Options Indexes FollowSymLinks
     AllowOverride None
     Require all granted
 </Directory></p>
<pre><code>Make sure `AllowOverride None` is set to `AllowOverride All`
* Restart Apache server (whenever you edit any apache config file, you must restart apache to enforce the changes)
* Enable mod rewrite in the config adding the following inside directive ` &lt;Directory /var/www/html&gt;` 

</code></pre>
<p>RewriteEngine On</p>
<pre><code>* Add to the above directive `&lt;Directory /var/www/html&gt;` a simple rule

</code></pre>
<p>RewriteRule X cgi/test.sh</p>
<pre><code>The rule simply says the URL ending with X, will be redirected to CGI/test.sh. Basically, the link `http://&lt;your-dns-address&gt;/X` will lead to your `test.sh` script
* All `RewriteRules` abide by the following format:

</code></pre>
<pre><code>RewriteRule pattern substitution [flags]
</code></pre>
<pre><code>where

* `RewriteRule` specifies the directive.
* `pattern` is a [regular expression (Regex)](https://www.digitalocean.com/community/tutorials/an-introduction-to-regular-expressions) that matches the desired string from the URL, which is what the viewer types in the browser.
* `substitution` is the path to the actual URL, i.e. the path of the file Apache servers.
* `flags` are optional parameters that can modify how the rule works.

* If you add special flag `[NC]` to `RewriteRule X cgi/test.s [NC]`, then it becomes case insensitive, so both `x` and `X` lead to the same executable.
* Let's write a more generic rewrite rule using variables. A variable is enclosed in parenthesis `()`, following the Regex standard. 

</code></pre>
<p>RewriteRule select/(a|b) cgi/test.sh?option=$1</p>
<pre><code>For example, the above rule redirects `&lt;url&gt;/select/a` and `&lt;url&gt;/select/b` to `/cgi/test.sh` where `$1` takes values  `a` and `b` for variable `option`. If you are not comfortable with Regex, you could write the above as two static rules

</code></pre>
<p>RewriteRule select/a cgi/test.sh?option=a
RewriteRule select/b cgi/test.sh?option=b
<code>``
* Now, from the bash script</code>test.sh<code>you could read the input through the environment variable</code>$QUERY_STRING`, which is set automatically by mod_rewrite.
* Try to write a simple bash script that outputs the figure below</p>
<p><img alt="" src="../imgs/sys5-mod-rewrite.png" /></p>
<h1 id="optional">Optional</h1>
<ul>
<li><a href="https://www.digitalocean.com/community/tutorials/how-to-rewrite-urls-with-mod_rewrite-for-apache-on-ubuntu-16-04">Additional mod_rewrite tutorial</a></li>
<li><a href="https://www.digitalocean.com/community/tutorials/an-introduction-to-regular-expressions">Regex tutorial</a></li>
<li><a href="https://httpd.apache.org/docs/current/mod/mod_rewrite.html">Full documentation for mod_rewrite</a></li>
</ul></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js"></script>
        <script src="../../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
